<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        span,
        button {
            border-radius: 3px;
            border: 2px;
            border-color: white;
            background-color: aquamarine;
            cursor: pointer;
            padding: 2px;
        }

        form {
            /* align-items: center; */
            /* border: 1px solid black;
            border-radius: 5px; */
            display: flex;
            flex-direction: column;
        }

        label,input{
            margin: 5px
        }
        #updateuser{
            /* display: flex;
            height: 100vh;
            justify-content: center;
            border: 1px solid black;
            border-radius: 5px;
            width: 300px; */
            visibility: hidden;
        }

        div {
            margin-top: 50px;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        table {
            border-color: white;
        }

        td {
            padding: 10px;
        }

        input {
            border-radius: 5px;
            padding: 3px;
        }

        input[type=submit] {
            cursor: pointer;
            background-color: aquamarine;

        }

        a {
            text-decoration: none;
            color: white;
        }

        #userdata {
            visibility: hidden;
            padding: 10px;
            width: 500px;
            border: 1px solid black;
            border-radius: 5px;
        }

        .delimeters {

            width: 650px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;

        }

        .modal {
            /* background-color: aliceblue; */
            border: 1 px solid white;
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            /* z-index: 1; */
            /* Sit on top */
            left: 0;
            top: 0;
            /* width: 100%; */
            /* Full width */
            /* height: 100%; */
            /* Full height */
            /* overflow: auto; */
            /* Enable scroll if needed */
              /* Black w/ opacity */
        }
    </style>
</head>

<body>

    <h1>Hello Admin</h1><br>

    <div>
        <button id="adduser">Add User</button><br>

        <table border="2px">
            <tr>
                <td><b>id</b></td>
                <td><b>name</b></td>
                <td><b>email</b></td>
                <td><b>role</b></td>
                <td><b>delete</b></td>
                <td><b>edit</b></td>

            </tr>


            <% for(var i=0;i<users.length;i++) {%>

                <tr>

                    <td>
                        <%=i+1%>
                    </td>
                    <td>
                        <%= users[i].name %>
                    </td>
                    <td>
                        <%= users[i].email %>
                    </td>
                    <td>
                        <%= users[i].role.name %>
                    </td>

                    <td> <span onclick="confirmation(`<%= users[i].id %>`)"> Delete</span></td>
                    <!-- <td> <span onclick="updateUser()" id="edit">Edit </span></td> -->
                    <td><button id="updateBtn" onclick="updateUser(`<%= users[i].id %>`)">Edit</button></td>


                </tr>
                <% } %>

        </table>

    </div>

    <div id="createuser" class="modal">
        <div>
            <form action="/users" method="post">
                <label for="name">Name</label><br>
                <input type="text" name="name" id="name"><br><br>

                <label for="email">email</label><br>
                <input type="email" name="email" id="email"><br><br>

                <label for="password">password</label><br>
                <input type="password" name="password" id="password"><br><br>

                <label for="role">role</label><br>
                <input type="text" name="roleId" id="roleId"><br><br>

                <button type="submit">Create User</button>
            </form>
        </div>
    </div>

    <% users.forEach(function(user) { %>
    <div id="updateuser<%=user.id%>" class="modal">
        <div>
            <form action="/users/<%=user.id%>" method="put">
                <label for="name">Name</label><br>
                <input type="text" name="name" id="name"><br><br>

                <label for="email">email</label><br>
                <input type="email" name="email" id="email" ><br><br>

                <label for="password">password</label><br>
                <input type="password" name="password" id="password" ><br><br>

                <label for="role">role</label><br>
                <input type="text" name="roleId" id="roleId" ><br><br>

                <button type="submit" id="updateData">Update User</button>
            </form>

        </div>
    </div>
    <% }) %>

    <div class="model-container" id="updateuser"  class="modal">
        <div class="model">
            <div onclick="document.querySelector('.model-container').style.visibility = 'hidden'">Close</div>
            <form id="updateForm">

                <label for="name">Name</label>
                <input type="text" name="name" id="updateName">

                <label for="email">email</label>
                <input type="email" name="email" id="updateEmail" >

                <label for="role">role</label>
                <input type="text" name="roleId" id="updateRole" >

                <button type="submit" id="updateData">Update User</button>
               
            </form>
        </div>
    </div>



    <% users.forEach(function(user) { %>
        <!-- Edit User Modal -->
        <div class="modal fade" id="editModal<%= user.id %>" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form action="/users/<%= user.id %>" method="PUT">
                  <div class="form-group">
                    <label for="edit-name">Name</label>
                    <input type="text" class="form-control" id="edit-name" name="name" placeholder="Enter name" value="<%= user.name %>" required>
                  </div>
                  <div class="form-group">
                    <label for="edit-email">Email</label>
                    <input type="email" class="form-control" id="edit-email" name="email" placeholder="Enter email" value="<%= user.email %>" required>
                  </div>
                  <div class="form-group">
                    <label for="edit-email">Password</label>
                    <input type="Password" class="form-control" id="edit-password" name="password" placeholder="Enter password" value="<%= user.password %>" required>
                  </div>
                  <button type="submit" class="btn btn-primary">Update</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    


<script>

    const updateUser = async (id)=>{
        
        const email = document.getElementById('email');
        const roleId = document.getElementById('roleId');

        var modal1 = document.getElementById("updateuser");
        modal1.style.visibility = "visible";

        const res = await axios.get(`/users/user/${id}`);
        const user = res.data;
        console.log(res);
        console.log(user);
        document.getElementById('updateName').value = user.name;
        document.getElementById('updateEmail').value = user.email;
        document.getElementById('updateRole').value = user.roleId;

        const updateForm = document.querySelector('#updateuser');
        updateForm.addEventListener('submit', async (e)=>{
            e.preventDefault()
            const res1 = await axios.put(`/users/${id}`, {
               
                name: document.getElementById('updateName').value,
                email: document.getElementById('updateEmail').value,
                roleId: document.getElementById('updateRole').value,
            })
            // modal1.style.visibility = "hidden"; 
            document.querySelector('.model-container').style.visibility = "hidden";


            console.log(res1);
        })

       
    
    }

    function getAllUsers() {
        
    }

    // function updateData(id){
    //     alert("hello");
    //     var modal1 = document.getElementById("updateuser");
    //     var Ubtn = document.getElementById("updateBtn");
    //     Ubtn.onclick = function () {
    //     modal1.style.display = "block"
    //     }
    //     window.onclick = function (event) {
    //     if (event.target == modal1) {
    //         modal1.style.display = "none";
    //     }
    // }

    // axios.put('http://127.0.0.1:3000/users/id')
    //     .then(function (response) {response.data})
    //     // fetch(`http://127.0.0.1:3000/users/id`);

    // }

    var modal = document.getElementById("createuser");
    var btn = document.getElementById("adduser");
    btn.onclick = function () {
        modal.style.display = "block"
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // var modal1 = document.getElementById("updateuser");
    // var Ubtn = document.getElementById("updateBtn");
    // Ubtn.onclick = function () {
    //     modal1.style.display = "block"
    // }
    // window.onclick = function (event) {
    //     if (event.target == modal1) {
    //         modal1.style.display = "none";
    //     }
    // }

    // function updateUser(id){
    //  var updateBtn = document.getElementById('updateData');

    //  updateBtn.addEventListener('click', ()=>{
    //     fetch(`http://127.0.0.1:5000/users/id`);
    //  })
   
    // }

   

    async function confirmation(id) {
        if (confirm("Are you sure you want to delete this data..?")) {


            // fetch(`http://127.0.0.1:5000/delete/${id}`);

            axios.delete(`/users/${id}`).then(function (response) { return "data deleted"})
            // document.getElementById(id).style.display = "none";
            // document.getElementById('').style.display = "none";


        } else {
            alert("not deleted");
        }
    }


    // async function updateUser() {
    //     console.log('update');
    //     var usermodal = document.getElementById('userdata');

    //     var editBtn = document.getElementById('edit');
    //     console.log(editBtn);

    //     console.log(usermodal);
    //     usermodal.style.visibility = "visibal";
    // }

    async function editUser() {

        let data = ""
        let data1 = ""
        data1 += `<div class="edit-form" id="edit-form">    
            <form action="" method="">
            <label for="email">email</label>
            <input type="email" name="email" id="email"><br>
            <button type="submit>Update</button>
        </form>
    </div>`


        data += `<div class="showdata">
        <table class="tab">
            <tr>
                <div class="column-entry">
                    <div class="coll">
                        <h4>Name</h4>
                    </div>
                    <div class="coll">
                        <h4>Leave Date</h4>
                    </div>
                    <div class="coll">
                        <h4>Leave Type</h4>
                    </div>
                    <div class="coll">
                        <h4>Leave Reason</h4>
                    </div>
                    <div class="coll">
                        <h4>Half Day</h4>
                    </div>
                    
            </tr>
            <tr>
                <div class="column2">
                    <div class="col-data">
                        <p></p>
                    </div>
                    <div class="col-data">
                        <p></p>
                    </div>
                    <div class="col-data">
                        <p></p>
                    </div>
                    <div class="col-data">
                        <p></p>
                    </div>
                    <div class="col-data">
                        <p></p>
                    </div>
                </div>
            </tr>
        </table>       
        </div>
        <div class="leave-status">
        <p>Your leave-status : </p>
        </div>
<div class="apply">
     
 

              
</div>`;

        let showData = document.createElement("div");
        showData.className = "show";
        showData.innerHTML = data;
        document.getElementById("userdata").appendChild(showData);
    }

</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->
</body>

</html>