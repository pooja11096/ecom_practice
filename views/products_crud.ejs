<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="/css/crud.css">


  <style>

  </style>
  <link rel="stylesheet" href="https://unpkg.com/@webpixels/css@1.1.5/dist/index.css">

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.4.0/font/bootstrap-icons.min.css">
</head>

<body>

  <main class="py-6 bg-surface-secondary">
    <div class="container-fluid">

      <div class="card shadow border-0 mb-7">
        <div class="card-header">
          <div class="header">
            <h5 class="mb-0">Products</h5>

            <button id="add_product_btn" onclick="return addProductPage()">Add Products</button>
          </div>

        </div>
        <div class="table-responsive">


          <table class="table table-hover table-nowrap">
            <thead class="thead-light">
              <tr>
                <th scope="col">Product Name</th>
                <th scope="col">Description</th>
                <th scope="col">Price</th>
                <th scope="col">Categories</th>
                <th scope="col">Delete</th>
                <th scope="col">Edit</th>
                <th></th>
              </tr>

            </thead>
            <tbody>

              <!-- pooja_profile.jpeg -->
              <!-- ../uploads/<%= products.image_url %> -->
              <% for(var i=0;i<products.length;i++) {%>

                <!-- <tr>/home/pooja-makwana/Pictures/final_ecom/uploads -->
                <!-- <%=products[i].image_url%> -->
                <td>
                  <img src="/<%=products[i].image_url%>" class="avatar avatar-sm rounded-circle me-2">
                  <a class="text-heading font-semibold" href="#">
                    <%= products[i].product_name %>
                  </a>
                </td>
                <td>
                  <%= products[i].product_description %>

                </td>
                <td>
                  <a class="text-heading font-semibold" href="#">
                    <%= products[i].product_price %>

                  </a>
                </td>
                <td>
                  <ul>
                    <% for (let j=0; j< products[i].categories.length; j++) { %>
                      <li>
                        <%= products[i].categories[j].category_name %>
                      </li>
                      <% } %>
                  </ul>
                </td>


                <td> <span onclick="return confirmation(`<%= products[i].id %>`)"> Delete</span></td>

                <td><button id="updateProduct" onclick="updateUser(`<%= products[i].id %>`)">Edit</button>
                </td>



                </tr>
                <% } %>

            </tbody>
          </table>
        </div>
        <div class="card-footer border-0 py-5">
          <span class="text-muted text-sm">Showing 10 items out of 250 results found</span>
        </div>


        <div class="row" id="updateuser" style="visibility: hidden;">
          <div class="col-md-12">
            <form action="" method="">

              <fieldset>

                <label for="name">Product Name</label>
                <input type="text" id="updateName" name="product_name">

                <label for="product_description">Product description</label>
                <input type="text" id="updateDesc" name="product_description">

                <label for="product_price">Product price</label>
                <input type="text" id="updatePrice" name="product_price">

                <!-- <label for="password">Password</label>
                          <input type="password" id="password" name="password">
                 -->
                <!-- <label for="roleId">Role</label>
                          <input type="text" id="updateRole" name="roleId"> -->

                <button type="submit" id="updateUserBtn" onclick="return refreshPage()">Update User</button>

            </form>
          </div>
        </div>

      </div>
    </div>

    <!-- <div class="row" id="updateuser" style="visibility: hidden;">
                    <div class="col-md-12">
                      <form action="" method="" enctype="multipart/form-data">
                        
                        <fieldset>
                                  
                          <label for="name">Product Name</label>
                          <input type="text" id="updateName" name="product_name" >

                          <label for="name">Product Description</label>
                          <input type="text" id="updateDesc" name="product_description">

                          <label for="name">Product Price</label>
                          <input type="text" id="updatePrice" name="product_price">
 
                       
                        <button type="submit" id="updateUserBtn" >Update User</button>
                        
                       </form>
                        </div>
                      </div> -->


    </div>
    </div>

  </main>

  <script>

    function addProductPage() {
      location.assign('/categories/add_product_page')
    }


    const updateUser = async (id) => {

      console.log("hello update product");
      var modal1 = document.getElementById("updateuser");
      modal1.style.visibility = "visible";
      console.log("pid", `${id}`);

      const res = await axios.get(`/products/product/${id}`);
      const user = res.data;
      console.log("res", res);
      console.log("user", user);
      document.getElementById('updateName').value = user.product_name;
      document.getElementById('updateDesc').value = user.product_description;
      document.getElementById('updatePrice').value = user.product_price;
    }


    async function confirmation(id) {
      if (confirm("Are you sure you want to delete this data..?")) {

        axios.delete(`/products/${id}`).then(function (response) { return "data deleted" })

        window.location.reload()

      } else {
        alert("not deleted");
      }
    }


    async function pagination(page) {
      console.log(page);
      var set = '';

      await axios.post(`/products/page?page=${page}`).then(function (response) {
        console.log("", response.data);
        for (var i = 0; i < response.data.length; i++) {
          set += `<tr><td>${response.data[i].name}</td><td>${response.data[i].email}</td><td>${response.data[i].role.name}</td><td class="text-end"><button type="button" id="editbutton" class="login-trigger btn btn-sm btn-neutral" data-target="#login" data-toggle="modal" onclick="return editUser('${response.data[i].id}')">Edit</button><button type="button" class="btn btn-sm btn-square btn-neutral text-danger-hover" onclick=" userdelete('${response.data[i].id}')"><i class="bi bi-trash"></i></button></td></tr>`

        }
        console.log(set);
        document.getElementById("change").innerHTML = set;

      });
    }

    async function searching() {

      var val = document.getElementById("search").value
      console.log(val);
      var set = '';
      await axios.get(`/products/search?data=${val}`).then(function (response) {
        console.log("datt ===", response.data);


        for (var i = 0; i < response.data.length; i++) {
          set += `<tr><td>${response.data[i].name}</td><td>${response.data[i].email}</td><td>${response.data[i].role.name}</td><td class="text-end"><button type="button" id="editbutton" class="login-trigger btn btn-sm btn-neutral" data-target="#login" data-toggle="modal" onclick="return editUser('${response.data[i].id}')">Edit</button><button type="button" class="btn btn-sm btn-square btn-neutral text-danger-hover" onclick=" userdelete('${response.data[i].id}')"><i class="bi bi-trash"></i></button></td></tr>`
        }
        console.log(set);
        document.getElementById("change").innerHTML = set;
      });

    }


    async function sorting(sort) {
      console.log(sort);
      var set = '';
      number = document.getElementById("number").value;
      console.log(number);
      if (number % 2 == 0) {
        var plus = ++number;
        document.getElementById("number").value = plus;
        console.log("plus", plus);
        console.log("if", number % 2 == 0);
        var sort_type = 'desc';
        await axios.post(`/products/sort-user?data=${sort}&type=${sort_type}`).then(function (response) {
          console.log(response);

          for (var i = 0; i < response.data.length; i++) {

            set += `<tr><td>${response.data[i].name}</td><td>${response.data[i].email}</td><td>${response.data[i].role.name}</td><td class="text-end"><button type="button" id="editbutton" class="login-trigger btn btn-sm btn-neutral" data-target="#login" data-toggle="modal" onclick="return editUser('${response.data[i].id}')">Edit</button><button type="button" class="btn btn-sm btn-square btn-neutral text-danger-hover" onclick=" userdelete('${response.data[i].id}')"><i class="bi bi-trash"></i></button></td></tr>`


          }
          console.log(set);
          document.getElementById("change").innerHTML = set;
        });

      } else {
        var plus = ++number;
        console.log("plus", plus);
        document.getElementById("number").value = plus;


        console.log("else", number % 2 == 0);
        var sort_type = 'asc';
        await axios.post(`/products/sort-user?data=${sort}&type=${sort_type}`).then(function (response) {
          console.log(response);

          for (var i = 0; i < response.data.length; i++) {

            set += `<tr><td>${response.data[i].name}</td><td>${response.data[i].email}</td><td>${response.data[i].role.name}</td><td class="text-end"><button type="button" id="editbutton" class="login-trigger btn btn-sm btn-neutral" data-target="#login" data-toggle="modal" onclick="return editUser('${response.data[i].id}')">Edit</button><button type="button" class="btn btn-sm btn-square btn-neutral text-danger-hover" onclick=" userdelete('${response.data[i].id}')"><i class="bi bi-trash"></i></button></td></tr>`


          }
          console.log(set);
          document.getElementById("change").innerHTML = set;
        });

      }

    }

  </script>
</body>

</html>